from bs4 import BeautifulSoup
from ...utils.SeleniumUtils import SeleniumUtils
from selenium import webdriver
from ...utils.ConfigurationTools import ConfigurationTools
from ...models import ProductScraped
from location.models import Country
from products.models import Supermarket, Category
from tqdm import tqdm
import time

supermarket = Supermarket(name="Carrefour", zipcode="28019",
                          main_url="https://www.carrefour.es/", country=Country.objects.get(code='ESP'))

PRODUCTS_PER_PAGE = 24

def supermarket_in_db(supermarket, sqlite_api):
		supermarkets = sqlite_api.get_supermarkets()
		for supermarket_db in supermarkets:
			if supermarket_db[1] == supermarket.name and supermarket_db[2] == supermarket.zipcode and supermarket_db[3] == supermarket.main_url:
				return True
		return False

class CarrefourScraperLogic(object):
    
    def __init__(self):
        self.previous_category = None

    def extract_data(self, url, path, driver, selenium_utils):
        driver.get(url)
        selenium_utils.navigate_to(path[:path.rfind(';')])

        products = []
        category_selector = path.split(';')[-1].strip()

        selenium_utils.get_element_by_css_selector(
            '.nav-second-level-categories__text')
        
        page_source = driver.page_source
        soup = BeautifulSoup(page_source, 'lxml')
        
        try:
            category = soup.select(category_selector)[0].select(
                '.nav-second-level-categories__text')[0].get_text().strip()
        except Exception:
            print(path)

        
        selenium_utils.navigate_to(path[path.rfind(';')+1:])
        print(category)
        
        selenium_utils.get_element_by_css_selector('.plp-food-view__count')
        page_source = driver.page_source
        soup = BeautifulSoup(page_source, 'lxml')
        
        number_of_items = int(soup.select('.plp-food-view__count')[0].get_text().lower().replace("mostrando", "").replace("productos", "").strip())
        category_url = driver.current_url
        
        current_page = 0

        while current_page*PRODUCTS_PER_PAGE < number_of_items:
            print(current_page)
            driver.get(category_url + '?offset=%d' % (current_page*PRODUCTS_PER_PAGE))
            while True:
                page_source = driver.page_source
                soup = BeautifulSoup(page_source, 'lxml')
                common_parent = soup.select('.product-card-list__item .product-card')
                if len(common_parent) >= 10 or number_of_items - current_page*PRODUCTS_PER_PAGE < 10:
                    for item in common_parent:
                        raw_name = item.select(
                            '.product-card__detail > h2 > a')[0].get_text().strip()
                        offer_price = None
                        try:
                            price = float(item.select('.product-card__price')
                                        [0].get_text().strip().replace(' €', '').replace(',', '.'))
                        except Exception:
                            price = float(item.select('.product-card__price--strikethrough')
                                        [0].get_text().strip().replace(' €', '').replace(',', '.'))
                            offer_price = float(item.select('.product-card__price--current')
                                                [0].get_text().strip().replace(' €', '').replace(',', '.'))

                        unit_price = item.select(
                            '.product-card__price-per-unit')[0].get_text().strip()
                        product_url = supermarket.main_url[:-1] + item.select(
                            '.product-card__detail > h2 > a')[0].get('href').strip()
                        image = item.select('.product-card__image')[0].get('src').strip()
                        name = raw_name.lower().replace('.', '').strip()
                        weight_unit = unit_price.split('/')[1]
                        weight = None
                        previous_word = ''
                        for word in name.split(' '):
                            if weight_unit.lower() in word:
                                weight = previous_word + word
                                name = name.replace(weight + ' ', '').strip()
                                break
                            previous_word = word

                        amount = None
                        if 'pack' in name:
                            is_pack = True
                            try:
                                pack_info = name.split('pack')[1].strip().split(' ')
                                if pack_info[0] == 'de':
                                    amount = int(pack_info[1])
                                else:
                                    amount = int(pack_info[0])
                                    
                                name = name.split('pack')[0].strip()
                                
                            except Exception:
                                name = name.replace('pack', '').strip()
                        else:
                            is_pack = False

                        product = ProductScraped(name=name, price=price, unit_price=unit_price, weight=weight, brand=None, amount=amount, offer_price=offer_price,
                                                image=image, is_pack=is_pack, url=product_url, supermarket=supermarket, category=category)

                        products.append(product)
                        
                    current_page += 1
                    break
                else:
                    driver.execute_script("window.scrollBy(0, 500);")
                    time.sleep(1)
                    
        return products


def scraper(sqlite_api):
    driver_options = webdriver.ChromeOptions()
    driver_options.headless = True
    driver = webdriver.Chrome(options=driver_options)
    selenium_utils = SeleniumUtils(timeout=10, driver=driver)

    driver.get('https://www.carrefour.es/')
    
    if not supermarket_in_db(supermarket, sqlite_api):
        sql_supermarket = {"name": supermarket.name, "zipcode": supermarket.zipcode, "main_url": supermarket.main_url, "country": supermarket.country.code}
        sqlite_api._add_supermarket(sql_supermarket)

    # Include the zipcode configuration in this section
    ConfigurationTools.zipcode_carrefour(selenium_utils, driver)
    # -------------------------------------------------

    tree_paths = ['#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(3); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(1)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(3); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(2)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(3); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(3)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(3); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(4)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(3); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(5)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(3); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(6)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(3); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(7)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(3); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(8)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(3); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(9)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(4); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(1)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(4); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(2)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(4); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(3)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(4); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(4)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(4); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(5)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(4); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(6)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(4); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(7)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(4); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(8)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(5); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(1)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(5); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(2)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(5); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(3)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(5); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(4)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(5); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(5)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(5); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(6)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(5); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(7)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(5); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(8)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(5); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(9)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(6); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(1)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(6); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(2)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(6); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(3)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(6); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(4)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(6); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(5)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(6); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(6)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(6); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(7)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(6); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(8)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(7); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(1)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(7); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(2)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(7); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(3)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(7); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(4)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(7); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(5)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(7); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(6)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(7); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(7)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(7); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(8)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(7); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(9)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(7); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(10)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(7); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(11)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(7); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(12)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(8); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(1)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(8); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(2)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(8); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(3)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(8); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(4)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(8); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(5)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(8); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(6)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(8); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(7)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(8); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(8)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(9); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(1)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(9); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(2)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(9); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(3)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(9); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(4)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(9); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(5)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(10); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(1)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(10); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(2)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(10); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(3)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(10); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(4)', '#app > div > main > div.home-view__main > div.page > div > div > div > div.hst-container-item.cms-distributor-cat > div > div > div > ul > li:nth-child(3) > div > div > a > div:nth-child(2) > h2; #app > div > nav > div:nth-child(2) > div.home-food-view__nav > div.horizontal-navigation > div > div.carousel__elements > div > div:nth-child(10); #app > div > nav > div.plp-food-view__nav > div.horizontal-navigation.plp-food-view__nav-level--first > div.carousel.horizontal-navigation__second-level--parent > div.carousel__elements > div > div:nth-child(5)']

    products = []

    logic_extractor = CarrefourScraperLogic()

    for path in tqdm(tree_paths):
        products_to_add = logic_extractor.extract_data('https://www.carrefour.es/', path, driver, selenium_utils)

        products += products_to_add

    driver.quit()
    
    sqlite_api.add_products_scraped(products)
